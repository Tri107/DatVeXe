<%- include('../partials/header', { title: 'Quản lý chuyến', user }) %>

<section class="container mt-4">
  <h2 class="mb-3">Quản lý chuyến</h2>

  <form action="/admin/chuyen/add" method="POST" class="row g-2 mb-3">
    <div class="col-md-3">
      <input type="text" name="Chuyen_name" placeholder="Tên chuyến" class="form-control" required>
    </div>

    <div class="col-md-2">
      <select name="Tinh_Trang" class="form-select" required>
        <option value="còn chỗ">Còn chỗ</option>
        <option value="hết chỗ">Hết chỗ</option>
      </select>
    </div>

    <div class="col-md-3">
      <input type="datetime-local" name="Ngay_gio" class="form-control" required>
    </div>

    <div class="col-md-2">
      <select name="TuyenDuong_id" class="form-select" required>
        <option value="">Chọn tuyến đường</option>
        <% tuyen.forEach(t => { %>
          <option value="<%= t.TuyenDuong_id %>">
            <%= t.BenDi_name %> → <%= t.BenDen_name %>
          </option>
        <% }) %>
      </select>
    </div>

    <div class="col-md-1">
      <select name="Xe_id" class="form-select" required>
        <% xe.forEach(x => { %>
          <option value="<%= x.Xe_id %>"><%= x.Bien_so %></option>
        <% }) %>
      </select>
    </div>

    <div class="col-md-1">
      <select name="TaiXe_id" class="form-select" required>
        <% taixe.forEach(t => { %>
          <option value="<%= t.TaiXe_id %>"><%= t.TaiXe_name %></option>
        <% }) %>
      </select>
    </div>

    <div class="col-md-12 text-end">
      <button class="btn btn-primary">Thêm chuyến</button>
    </div>
  </form>

  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Tên chuyến</th>
        <th>Tình trạng</th>
        <th>Ngày giờ</th>
        <th>Tuyến đường</th>
        <th>Xe</th>
        <th>Tài xế</th>
        <th>Hành động</th>
      </tr>
    </thead>
    <tbody>
      <% list.forEach(c => { %>
        <tr>
          <td><%= c.Chuyen_id %></td>
          <td><%= c.Chuyen_name %></td>
          <td><%= c.Tinh_Trang %></td>
          <td><%= new Date(c.Ngay_gio).toLocaleString() %></td>
          <td><%= c.TuyenDuong_name %></td>
          <td><%= c.Bien_so %></td>
          <td><%= c.TaiXe_name %></td>
          <td>
            <a href="/admin/chuyen/edit/<%= c.Chuyen_id %>" class="btn btn-warning btn-sm">Sửa</a>
            <form action="/admin/chuyen/delete/<%= c.Chuyen_id %>" method="POST" style="display:inline;">
              <button class="btn btn-danger btn-sm" onclick="return confirm('Xóa chuyến này?')">Xóa</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</section>

<%- include('../partials/footer') %>
